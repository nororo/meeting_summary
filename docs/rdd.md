# 音声文字起こし・要約Q&Aアプリケーション 要件定義書（現状実装範囲）

## 1. はじめに

### 1.1 目的
本文書は、音声ファイルから文字起こしを行い、LLMを用いた要約や文字起こしに基づく質疑応答ができるウェブアプリケーションの現状実装されている詳細な要件を定義するものである。

### 1.2 適用範囲
本要件定義書は以下の範囲に適用される。
- 音声文字起こし処理機能
- LLMを用いた要約機能
- 文字起こしデータに対する質疑応答機能
- 議事録テンプレート処理機能
- ダウンロード機能
- Google Colaboratory環境での実行
- ローカル環境での実行

### 1.3 用語定義
| 用語 | 説明 |
|-----|------|
| LLM | Large Language Model（大規模言語モデル）。OpenAIのGPTモデルやLLama 3、Gemma 2などが該当する。 |
| 文字起こし | 音声データからテキストを抽出する処理 |
| Deepgram | 音声認識・文字起こしサービスを提供するAPI |
| Groq | LLMの推論を高速に実行するためのAPIサービス。Whisper、LLama 3、Gemma 2などのモデルを提供 |
| Azure OpenAI | MicrosoftのAzure上で提供されるOpenAIのAPIサービス |
| Map-Reduce | 大量のデータを分割して処理し、その結果を集約する処理手法 |
| Refine | 初期の要約から始めて徐々に改善していく要約手法 |

## 2. システム概要

### 2.1 システム構成
本システムは以下のコンポーネントで構成される。
- Webフロントエンド：HTMLインターフェース（Flask経由で提供）
- バックエンドサーバー：Pythonベース、Flaskフレームワークを使用
- 外部API連携：Deepgram、Groq、Azure OpenAI
- ファイル処理モジュール：音声ファイルの分割・処理、Wordドキュメント処理

### 2.2 システムアーキテクチャ
システムは以下の主要モジュールによって構成される。
1. ファイル管理モジュール
2. 文字起こしモジュール
3. LLM処理モジュール
4. テンプレート処理モジュール
5. ダウンロードモジュール

### 2.3 実行環境
1. Google Colaboratory環境：
   - ノートブック形式での実行
   - APIキーはColabのシークレット機能を利用
   - ウェブインターフェースはColabのポート公開機能を利用

2. ローカル環境：
   - Pythonランタイム（バージョン3.8以上推奨）
   - 仮想環境による隔離実行のオプション
   - APIキーは.envファイルで管理

## 3. 機能要件

### 3.1 ファイルアップロード機能
1. **音声ファイルアップロード**
   - 対応形式：mp3, wav, m4a（その他一般的な音声形式）
   - サイズ制限：最大100MB
   - 保存先：アプリケーション内の一時ストレージ

2. **議事録テンプレートアップロード**
   - 対応形式：Word文書（.docx）
   - テンプレート内にプレースホルダーを配置可能
   - 任意設定（テンプレートなしでも動作可能）

### 3.2 文字起こし機能
1. **API選択**
   - Deepgram API
   - Groq Whisper API
   - デフォルト：Deepgram API

2. **長時間音声処理**
   - 10分以上の音声は自動的に分割して処理
   - 分割サイズ：10分（コードで設定）
   - 分割結果の自動結合機能

3. **日本語対応**
   - 日本語音声の認識と文字起こし
   - APIリクエスト時に言語設定を指定

### 3.3 要約機能
1. **API選択**
   - Azure OpenAI API
   - Groq API
   - デフォルト：Azure OpenAI API

2. **Groqモデル選択**
   - LLama 3.3
   - Gemma-2
   - デフォルト：LLama 3.3

3. **要約方法選択**
   - Refine（より精度が高い）
   - Map-Reduce（より処理が速い）
   - デフォルト：Refine

4. **大量テキスト処理**
   - テキストを適切な長さに分割して処理
   - MAX_TOKENS設定（現状4000）

### 3.4 質疑応答機能
1. **API選択**
   - Azure OpenAI API
   - Groq API
   - デフォルト：Azure OpenAI API

2. **Groqモデル選択**
   - LLama 3.3
   - Gemma-2
   - デフォルト：LLama 3.3

3. **質問履歴管理**
   - 過去の質問と回答の履歴表示
   - 複数の質問と回答をセッション中に保持

4. **コンテキスト管理**
   - 文字起こしテキストを適切な長さに分割
   - 質問に関連する部分を処理

### 3.5 テンプレート処理機能
1. **プレースホルダー置換**
   - 文字起こしテキスト（`{{transcription}}`）
   - 要約テキスト（`{{summary}}`）

2. **テーブル処理**
   - テーブル内のプレースホルダー検出と置換
   - セル内のコンテンツ置換

3. **Q&Aセクション追加**
   - 質疑応答データの自動挿入
   - テーブル形式での質疑応答表示

### 3.6 ダウンロード機能
1. **出力形式選択**
   - Word文書（.docx）
   - テキストファイル（.txt）
   - JSONファイル（.json）
   - デフォルト：Word文書

2. **テンプレート利用オプション**
   - テンプレートを使用（アップロード済みの場合）
   - テンプレートなしでの出力
   - デフォルト：テンプレートを使用（利用可能な場合）

3. **出力ファイル管理**
   - タイムスタンプを含むファイル名
   - 生成ファイルのダウンロード機能

## 4. 非機能要件

### 4.1 セキュリティ要件
1. **APIキー管理**
   - Google Colaboratory環境：シークレット機能利用
   - ローカル環境：.envファイルによる管理
   - コード内へのキー直接記載の禁止

2. **一時ファイル管理**
   - アップロードファイルのセキュアな保存
   - clean_temp_files関数による古いファイルの削除機能（3600秒経過後）
   - ユニークなファイル名によるファイル分離（UUID生成）

### 4.2 性能要件
1. **応答時間**
   - 各処理はブラウザ上でローディングインジケータを表示
   - 非同期処理によるUI応答性の確保

2. **同時実行**
   - 単一セッション内での逐次処理
   - UIによる処理の順序制御

### 4.3 信頼性要件
1. **エラーハンドリング**
   - 各API呼び出しのエラー捕捉
   - ユーザーへのエラーメッセージ表示
   - 適切な例外処理

### 4.4 互換性要件
1. **ブラウザ互換性**
   - モダンブラウザ対応（Bootstrap 5およびjQueryベース）

2. **音声フォーマット互換性**
   - PyDubライブラリでサポートされる音声フォーマット

3. **Wordドキュメント互換性**
   - python-docxライブラリによる.docxフォーマット処理

## 5. インターフェース要件

### 5.1 ユーザーインターフェース
1. **全体構成**
   - Bootstrap 5ベースのレスポンシブUI
   - タブベースのナビゲーション

2. **主要タブ**
   - ファイルアップロードセクション
   - 文字起こしタブ
   - 要約タブ
   - 質疑応答タブ
   - ダウンロードタブ

3. **操作フロー**
   - 画面上部のタブによるナビゲーション
   - 各処理の依存関係に基づくボタンの有効/無効制御
   - 処理中のローディングインジケータ表示

### 5.2 外部インターフェース
1. **API連携**
   - Deepgram API: REST API呼び出し
   - Groq API: REST API呼び出し
   - Azure OpenAI: SDK利用
   - LangChain: 要約・QA処理フレームワーク

## 6. データ管理要件

### 6.1 データ構造
1. **主要データ要素**
   - 音声ファイル情報（パス）
   - 文字起こしテキスト
   - 要約テキスト
   - 質疑応答データ（質問と回答のペア）
   - テンプレートファイル情報

2. **データ保存形態**
   - セッション中のメモリ内保持（JavaScript変数）
   - 一時ファイルによるディスク保存

### 6.2 データ制約
1. **サイズ制限**
   - 音声ファイル：100MB（Flask設定）
   - アップロード中のタイムアウト制限なし

## 7. 環境特有要件

### 7.1 Google Colaboratory環境
1. **実行環境構築**
   - `run_in_colab.ipynb`によるガイド付きセットアップ
   - 必要なライブラリのインストール
   - APIキーの設定確認

2. **ポート公開**
   - ポート8000でのサーバー実行
   - Colabポート公開機能の利用

### 7.2 ローカル環境
1. **環境構築**
   - `run_local.py`による対話的セットアップ
   - 仮想環境オプション
   - 依存関係のインストール

2. **起動方法**
   - `start_local.bat`（Windows用）
   - `start_local.sh`（Mac/Linux用）
   - 手動実行オプション

3. **APIキー管理**
   - `.env`ファイルによる管理
   - `.env.example`によるテンプレート

## 8. 実装済みコードファイル一覧

1. `app.py` - メインアプリケーションエントリーポイント
2. `modules/transcription.py` - 文字起こし機能モジュール
3. `modules/llm_processing.py` - LLM処理（要約・Q&A）モジュール
4. `modules/template_handler.py` - 議事録テンプレート処理モジュール
5. `modules/file_handler.py` - ファイル管理モジュール
6. `modules/download_handler.py` - ダウンロード処理モジュール
7. `templates/index.html` - メインページHTML
8. `requirements.txt` - 依存パッケージ一覧
9. `setup.py` - セットアップスクリプト
10. `run_local.py` - ローカル実行スクリプト
11. `run_in_colab.ipynb` - Google Colab用ノートブック
12. `start_local.bat` - Windows用起動スクリプト
13. `start_local.sh` - Mac/Linux用起動スクリプト
14. `.env.example` - 環境変数テンプレート
15. `README.md` - 使用方法説明書

## 変更履歴
| バージョン | 日付 | 変更内容 | 変更者 |
|----------|------|---------|--------|
| 1.0 | 2025-03-10 | 初版作成 | システム設計者 |
